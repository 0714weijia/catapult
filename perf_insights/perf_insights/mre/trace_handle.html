<!DOCTYPE html>
<!--
Copyright 2015 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<link rel="import" href="/tracing/base/guid.html">

<script>
'use strict';

tr.exportTo('pi.mre', function() {
  function TraceHandle(sourceURL) {
    this.sourceURL_ = sourceURL;
  }

  TraceHandle.prototype = {
    get sourceURL() { return this.sourceURL_; },

    asDict: function() {
      var d = {
        source_url: this.source_url_
      };

      this._asDictInto(d);
      if (d.type === undefined)
        throw new Error('_asDictInto must set type field');
    },

    read: function() {
      throw new Error('Not implemented');
    }
  };

  TraceHandle.fromDict = function(handleDict) {
    if (d.type === 'local_file')
      return pi.mre.LocalFileTraceHandle.fromDict(handleDict);

    throw new Error('Not implemented');
  };


  function FileURLTraceHandle(sourceURL, metadata) {
    // TODO(eakuefner): startswith file
    TraceHandle.call(this, sourceURL);
    this.metadata = metadata;
  }

  FileURLTraceHandle.prototype = {
    __proto__: TraceHandle.prototype,

    _asDictInto: function(handleDict) {
      handleDict.metadata = this.metadata;
      handleDict.type = 'local_file';
    }

    read: function() {
      try {
        return tr.b.getSync(this.sourceURL);
      } catch (ex) {
        var err = new Error('Could not open ' + this.sourceURL);
        err.name = 'TraceImportError';
        throw err;
      }
    }
  };

  return {
    TraceHandle: TraceHandle,
    LocalFileTraceHandle: LocalFileTraceHandle
  };
});
</script>
